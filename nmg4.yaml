# OpenClash å…¨é¢ä¼˜åŒ–é…ç½®æ–‡ä»¶

# åŸºæœ¬è®¾ç½®
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: true

# DNS è®¾ç½®
dns:
  enable: true
  ipv6: true
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftncsi.com'
    - 'www.msftconnecttest.com'
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - https://cloudflare-dns.com/dns-query
    - https://dns.google/dns-query
  fallback:
    - tls://1.1.1.1:853
    - tls://8.8.8.8:853
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
  nameserver-policy:
    'geosite:cn': [127.0.0.1:5635]  # AdGuardHome ä»…å¤„ç†å›½å†…åŸŸå
    '+.google.com': [8.8.8.8, 8.8.4.4]
    '+.facebook.com': [8.8.8.8, 8.8.4.4]
    '+.youtube.com': [8.8.8.8, 8.8.4.4]
    '+.github.com': [1.1.1.1, 1.0.0.1]

# TCP ä¼˜åŒ–
tcp-concurrent: true

# è¿æ¥ä¼˜åŒ–
connection-pool-size: 128  # è°ƒæ•´ä¸º128ï¼Œå¹³è¡¡æ€§èƒ½

# TLS ä¼˜åŒ–
tls:
  certificate: "custom_cert.pem"  # å¦‚æœæœ‰è‡ªå®šä¹‰è¯ä¹¦ï¼Œè¯·æä¾›æ­£ç¡®çš„è·¯å¾„
  private-key: "custom_key.pem"   # å¦‚æœæœ‰è‡ªå®šä¹‰ç§é’¥ï¼Œè¯·æä¾›æ­£ç¡®çš„è·¯å¾„

# eBPF ä¼˜åŒ–
ebpf:
  redirect-to-tun:
    - eth0  # è¯·æ ¹æ®å®é™…ç½‘å¡åç§°ä¿®æ”¹
  auto-redir: true

# ä»£ç†æä¾›å•†
proxy-providers:
  æœºåœºè®¢é˜…:
    type: http
    url: "https://tudou-dyapi.tudouyun.top/api/v1/client/subscribe?token=f0d5eda7efd87a99e2e94f8790276706"
    interval: 604800  # æ¯å‘¨æ›´æ–°
    path: ./proxies/airport_proxies.yaml
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
      lazy: true

# ä»£ç†ç»„è®¾ç½®
proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹
      - ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹
      - DIRECT
    use:
      - æœºåœºè®¢é˜…

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600  # è°ƒæ•´ä¸º3600ç§’ï¼ˆ1å°æ—¶ï¼‰

  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ¸¯|HK|Hong|CM.*é¦™æ¸¯|CT.*é¦™æ¸¯|CU.*é¦™æ¸¯"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ–°åŠ å¡|ç‹®åŸ|SG|Singapore|CT.*æ–°åŠ å¡|CU.*æ–°åŠ å¡"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)ç¾|US|United States|CT.*ç¾å›½|CU.*ç¾å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ—¥æœ¬|JP|Japan|CU.*æ—¥æœ¬|CM.*æ—¥æœ¬|CT.*æ—¥æœ¬"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)éŸ©å›½|KR|Korea|CM.*éŸ©å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)å°|TW|Taiwan|CT.*å°æ¹¾"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)å°å°¼|ID|Indonesia|CM.*å°å°¼"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)è·å…°|NL|Netherlands|CU.*è·å…°"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ³°å›½|TH|Thailand|CT.*æ³°å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 3600

  - name: "ğŸŒ å›½å¤–åª’ä½“"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹
      - ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹
      - DIRECT

  - name: "ğŸ“² ç”µæŠ¥ä¿¡æ¯"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - DIRECT

  - name: "â“‚ï¸ å¾®è½¯æœåŠ¡"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹

  - name: "ğŸ è‹¹æœæœåŠ¡"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹

  - name: "ğŸ¯ å…¨çƒç›´è¿"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  - name: "ğŸ›‘ å…¨çƒæ‹¦æˆª"
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: "ğŸƒ åº”ç”¨å‡€åŒ–"
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ¯ å…¨çƒç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹

  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    proxies:
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹

# è§„åˆ™æä¾›å•†
rule-providers:
  reject:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/BanAD.yaml"
    path: ./ruleset/reject.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  icloud:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/iCloud.yaml"
    path: ./ruleset/icloud.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  apple:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Apple.yaml"
    path: ./ruleset/apple.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  google:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Google.yaml"
    path: ./ruleset/google.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  microsoft:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Microsoft.yaml"
    path: ./ruleset/microsoft.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  telegram:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Telegram.yaml"
    path: ./ruleset/telegram.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  streaming:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ProxyMedia.yaml"
    path: ./ruleset/streaming.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  global:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ProxyGFWlist.yaml"
    path: ./ruleset/global.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  cn:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ChinaDomain.yaml"
    path: ./ruleset/cn.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  ai-services:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./ruleset/ai_services.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

  ad-block:
    type: http
    behavior: classical
    url: "https://anti-ad.net/clash.yaml"
    path: ./ruleset/ad-block.yaml
    interval: 604800  # æ¯å‘¨æ›´æ–°

# è§„åˆ™
rules:
  - RULE-SET,ad-block,REJECT
  - DOMAIN-SUFFIX,openai.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,ai.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,chatgpt.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,anthropic.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,claude.ai,ğŸ¤– AI æœåŠ¡
  - RULE-SET,ai-services,ğŸ¤– AI æœåŠ¡
  - RULE-SET,reject,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,icloud,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,apple,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,telegram,ğŸ“² ç”µæŠ¥ä¿¡æ¯
  - RULE-SET,streaming,ğŸŒ å›½å¤–åª’ä½“
  - RULE-SET,global,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cn,ğŸ¯ å…¨çƒç›´è¿
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# è‡ªå®šä¹‰DNS
custom-dns:
  - 127.0.0.1  # AdGuardHome DNSï¼Œä»…ç”¨äºæœ¬åœ°è§£æ

# é«˜çº§è®¾ç½®
profile:
  store-selected: true
  store-fake-ip: true

# è‡ªå®šä¹‰æœ¬åœ° SOCKS5/HTTP(S) æœåŠ¡å™¨
external-controller: 0.0.0.0:9090
secret: "your-secret-key"  # è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å¯†é’¥

# å¤–éƒ¨ UI
external-ui: /usr/share/openclash/dashboard

# è‡ªå®šä¹‰é…ç½®ç›®å½•
config-dir: /etc/openclash/config

# å·¥ä½œç›®å½•
work-dir: /etc/openclash/work

# é…ç½®é‡è½½é—´éš”
config-reload-interval: 604800  # æ¯å‘¨é‡æ–°åŠ è½½é…ç½®

# è‡ªå®šä¹‰ GEO æ•°æ®åº“
geox-url:
  geoip: "https://github.com/Loyalsoldier/geoip/raw/release/Country.mmdb"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/raw/release/geosite.dat"
  mmdb: "https://github.com/Loyalsoldier/geoip/raw/release/Country.mmdb"

# å­è¿›ç¨‹ç®¡ç†
allow-subprocess: true
subprocess-max-num: 32  # è°ƒæ•´ä¸º32ï¼Œä¼˜åŒ–ç³»ç»Ÿèµ„æºä½¿ç”¨
subprocess-alive-interval: 60
subprocess-alive-timeout: 10

# æ—¥å¿—è®¾ç½®
log-file: /var/log/openclash.log
log-max-size: 50  # è°ƒæ•´ä¸º50MBï¼Œå‡å°‘å ç”¨
log-max-backups: 3  # è°ƒæ•´ä¸º3ä¸ªå¤‡ä»½
log-compress: true

# é«˜çº§ HTTP è®¾ç½®
http:
  mitm:
    - '+.googlevideo.com'
  rewrite:
    - '^https?://www\.google\.com http://www\.google\.com 302'

# åƒå…†ç½‘ç»œä¼˜åŒ–
interface-name: eth0  # è¯·æ ¹æ®å®é™…ç½‘å¡åç§°ä¿®æ”¹
mtu: 1500

# TUN æ¨¡å¼è®¾ç½®
tun:
  enable: true
  stack: system
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true

# é«˜çº§è·¯ç”±è®¾ç½®
routing-mark: 6666

# UDPä¼˜åŒ–
udp:
  enable: true
  timeout: 5

# è„šæœ¬
script:
  code: |
    def main(ctx, metadata):
      # æ ¹æ®æ—¶é—´é€‰æ‹©ä¸åŒçš„ç­–ç•¥ç»„
      hour = int(ctx.now().hour)
      if 9 <= hour < 18:
        return "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      else:
        return "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"

# è‡ªå®šä¹‰åŸŸåè§£æ
hosts:
  'mtalk.google.com': 108.177.125.188
  'dl.google.com': 180.163.151.161
  'dl.l.google.com': 180.163.151.161

# å®éªŒæ€§åŠŸèƒ½
experimental:
  # ä¿æŒä¸ºç©ºæˆ–æ³¨é‡Šæ‰ï¼Œä»¥ç¦ç”¨å®éªŒæ€§åŠŸèƒ½

