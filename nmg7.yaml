# OpenClash ä¼˜åŒ–é…ç½®æ–‡ä»¶

# åŸºæœ¬è®¾ç½®
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: true

# DNS è®¾ç½®ï¼ˆå°å¹…ä¼˜åŒ–ï¼‰
dns:
  enable: true
  ipv6: true
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftncsi.com'
    - 'www.msftconnecttest.com'
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 114.114.114.114  # æ·»åŠ å›½å†…DNS
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - https://cloudflare-dns.com/dns-query
    - https://dns.google/dns-query
    - 114.114.114.114  # æ·»åŠ å›½å†…DNS
  fallback:
    - tls://1.1.1.1:853
    - tls://8.8.8.8:853
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
  nameserver-policy:
    'geosite:cn': [114.114.114.114, 119.29.29.29]  # ä½¿ç”¨å›½å†…DNSè§£æä¸­å›½åŸŸå

# TCP ä¼˜åŒ–
tcp-concurrent: true

# è¿æ¥ä¼˜åŒ–
connection-pool-size: 128

# eBPF ä¼˜åŒ–
ebpf:
  redirect-to-tun:
    - eth0
  auto-redir: true

# ä»£ç†æä¾›å•†ï¼ˆå°å¹…ä¼˜åŒ–æ›´æ–°é¢‘ç‡ï¼‰
proxy-providers:
  æœºåœºè®¢é˜…:
    type: http
    url: "https://tudou-dyapi.tudouyun.top/api/v1/client/subscribe?token=f0d5eda7efd87a99e2e94f8790276706"
    interval: 86400  # æ¯24å°æ—¶æ›´æ–°ä¸€æ¬¡
    path: ./proxies/airport_proxies.yaml
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
      lazy: true

# ä»£ç†ç»„è®¾ç½®ï¼ˆä¿æŒåŸæœ‰è®¾ç½®ï¼Œå¢åŠ è´Ÿè½½å‡è¡¡é€‰é¡¹ï¼‰
proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ”€ è´Ÿè½½å‡è¡¡  # æ–°å¢è´Ÿè½½å‡è¡¡é€‰é¡¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹
      - ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹
      - DIRECT
    use:
      - æœºåœºè®¢é˜…

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    url: 'http://www.gstatic.com/generate_204'
    interval: 300  # æ¯5åˆ†é’Ÿæµ‹è¯•ä¸€æ¬¡

  - name: "ğŸ”€ è´Ÿè½½å‡è¡¡"  # æ–°å¢è´Ÿè½½å‡è¡¡ç»„
    type: load-balance
    use:
      - æœºåœºè®¢é˜…
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    strategy: round-robin

  # å…¶ä»–èŠ‚ç‚¹ç»„ä¿æŒä¸å˜...

  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ¸¯|HK|Hong|CM.*é¦™æ¸¯|CT.*é¦™æ¸¯|CU.*é¦™æ¸¯"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ–°åŠ å¡|ç‹®åŸ|SG|Singapore|CT.*æ–°åŠ å¡|CU.*æ–°åŠ å¡"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)ç¾|US|United States|CT.*ç¾å›½|CU.*ç¾å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ—¥æœ¬|JP|Japan|CU.*æ—¥æœ¬|CM.*æ—¥æœ¬|CT.*æ—¥æœ¬"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)éŸ©å›½|KR|Korea|CM.*éŸ©å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)å°|TW|Taiwan|CT.*å°æ¹¾"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)å°å°¼|ID|Indonesia|CM.*å°å°¼"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)è·å…°|NL|Netherlands|CU.*è·å…°"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹"
    type: url-test
    use:
      - æœºåœºè®¢é˜…
    filter: "(?i)æ³°å›½|TH|Thailand|CT.*æ³°å›½"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name: "ğŸŒ å›½å¤–åª’ä½“"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡®ğŸ‡© å°å°¼èŠ‚ç‚¹
      - ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡­ æ³°å›½èŠ‚ç‚¹
      - DIRECT

  - name: "ğŸ“² ç”µæŠ¥ä¿¡æ¯"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - DIRECT

  - name: "â“‚ï¸ å¾®è½¯æœåŠ¡"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹

  - name: "ğŸ è‹¹æœæœåŠ¡"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹

  - name: "ğŸ¯ å…¨çƒç›´è¿"
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  - name: "ğŸ›‘ å…¨çƒæ‹¦æˆª"
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: "ğŸƒ åº”ç”¨å‡€åŒ–"
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ¯ å…¨çƒç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹

  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    proxies:
      - ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹

# è§„åˆ™æä¾›å•†ï¼ˆä¿æŒä¸å˜ï¼‰
rule-providers:
  reject:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/BanAD.yaml"
    path: ./ruleset/reject.yaml
    interval: 86400  # æ¯24å°æ—¶æ›´æ–°ä¸€æ¬¡

  icloud:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/iCloud.yaml"
    path: ./ruleset/icloud.yaml
    interval: 86400

  apple:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Apple.yaml"
    path: ./ruleset/apple.yaml
    interval: 86400

  google:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Google.yaml"
    path: ./ruleset/google.yaml
    interval: 86400

  microsoft:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Microsoft.yaml"
    path: ./ruleset/microsoft.yaml
    interval: 86400

  telegram:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Ruleset/Telegram.yaml"
    path: ./ruleset/telegram.yaml
    interval: 86400

  streaming:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ProxyMedia.yaml"
    path: ./ruleset/streaming.yaml
    interval: 86400

  global:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ProxyGFWlist.yaml"
    path: ./ruleset/global.yaml
    interval: 86400

  cn:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ChinaDomain.yaml"
    path: ./ruleset/cn.yaml
    interval: 86400

  ai-services:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./ruleset/ai_services.yaml
    interval: 86400

  ad-block:
    type: http
    behavior: classical
    url: "https://anti-ad.net/clash.yaml"
    path: ./ruleset/ad-block.yaml
    interval: 86400

  gfw:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/GFWlist.yaml"
    path: ./ruleset/gfw.yaml
    interval: 86400

  greatfire:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/Greatfire.yaml"
    path: ./ruleset/greatfire.yaml
    interval: 86400

  tld-not-cn:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/TLDNotCN.yaml"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400

# è§„åˆ™ï¼ˆä¿æŒåŸæœ‰é¡ºåºï¼Œæ·»åŠ å°‘é‡è‡ªå®šä¹‰è§„åˆ™ï¼‰
rules:
  # è‡ªå®šä¹‰è§„åˆ™ï¼ˆæ ¹æ®ä¸ªäººéœ€æ±‚æ·»åŠ ï¼‰
  - DOMAIN-SUFFIX,example.com,DIRECT
  - DOMAIN-KEYWORD,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-KEYWORD,youtube,ğŸŒ å›½å¤–åª’ä½“
  
 # åŸæœ‰è§„åˆ™
  - RULE-SET,ad-block,REJECT
  - DOMAIN-SUFFIX,openai.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,ai.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,chatgpt.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,anthropic.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,claude.ai,ğŸ¤– AI æœåŠ¡
  - RULE-SET,ai-services,ğŸ¤– AI æœåŠ¡
  - RULE-SET,reject,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,icloud,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,apple,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,telegram,ğŸ“² ç”µæŠ¥ä¿¡æ¯
  - RULE-SET,streaming,ğŸŒ å›½å¤–åª’ä½“
  - RULE-SET,global,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cn,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,greatfire,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,tld-not-cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# è‡ªå®šä¹‰DNS
custom-dns:
  - 127.0.0.1:5635  # AdGuardHome DNSï¼Œä»…ç”¨äºæœ¬åœ°è§£æ

# é«˜çº§è®¾ç½®
profile:
  store-selected: true
  store-fake-ip: true

# è‡ªå®šä¹‰æœ¬åœ° SOCKS5/HTTP(S) æœåŠ¡å™¨
external-controller: 0.0.0.0:9090
secret: "your-secret-key"  # è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å¯†é’¥

# å¤–éƒ¨ UI
external-ui: /usr/share/openclash/dashboard

# è‡ªå®šä¹‰é…ç½®ç›®å½•
config-dir: /etc/openclash/config

# å·¥ä½œç›®å½•
work-dir: /etc/openclash/work

# é…ç½®é‡è½½é—´éš”
config-reload-interval: 604800  # æ¯å‘¨é‡æ–°åŠ è½½é…ç½®

# è‡ªå®šä¹‰ GEO æ•°æ®åº“
geox-url:
  geoip: "https://github.com/Loyalsoldier/geoip/raw/release/Country.mmdb"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/raw/release/geosite.dat"
  mmdb: "https://github.com/Loyalsoldier/geoip/raw/release/Country.mmdb"

# å­è¿›ç¨‹ç®¡ç†
allow-subprocess: true
subprocess-max-num: 32
subprocess-alive-interval: 60
subprocess-alive-timeout: 10

# æ—¥å¿—è®¾ç½®
log-file: /var/log/openclash.log
log-max-size: 50
log-max-backups: 3
log-compress: true

# é«˜çº§ HTTP è®¾ç½® (å¯é€‰)
http:
  mitm:
    - '+.googlevideo.com'
  rewrite:
    - '^https?://www\.google\.com http://www\.google\.com 302'

# åƒå…†ç½‘ç»œä¼˜åŒ–
interface-name: eth0  # è¯·æ ¹æ®å®é™…ç½‘å¡åç§°ä¿®æ”¹
mtu: 1500

# TUN æ¨¡å¼è®¾ç½®
tun:
  enable: true
  stack: system
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true

# é«˜çº§è·¯ç”±è®¾ç½®
routing-mark: 6666

# UDPä¼˜åŒ–
udp:
  enable: true
  timeout: 5

# è„šæœ¬
script:
  code: |
    def main(ctx, metadata):
      hour = int(ctx.now().hour)
      if 9 <= hour < 18:
        return "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      else:
        return "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"

# è‡ªå®šä¹‰åŸŸåè§£æ
hosts:
  'mtalk.google.com': 108.177.125.188
  'dl.google.com': 180.163.151.161
  'dl.l.google.com': 180.163.151.161

# å®éªŒæ€§åŠŸèƒ½
experimental:
  # ä¿æŒä¸ºç©ºæˆ–æ³¨é‡Šæ‰ï¼Œä»¥ç¦ç”¨å®éªŒæ€§åŠŸèƒ½